<!DOCTYPE html>
<html lang="it">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Agritech - I Tuoi Campi</title>
    <link rel="stylesheet" href="../static/css/style.css" />
  </head>

  <body>
    <!-- NAVBAR -->
    <nav class="navbar" role="navigation">
      <div class="navbar-top container">
        <a href="#" class="logo">Agritech</a>
        <div class="user-nav">
          <div class="user-info">
            <img
              src="../static/image/profilo.png"
              alt="Profilo"
              class="user-avatar-img"
            />
            <a href="/profilo" class="profile-link">{{user['username']}}</a>
            <form method="POST" action="/logout">
              <button type="submit" class="logout-btn">Logout</button>
            </form>
          </div>
        </div>
      </div>

      <div class="navbar-menu container">
        <ul class="nav-links">
          <li class="nav-link"><a href="/">Home</a></li>
          <li class="nav-link"><a href="#about">Chi Siamo</a></li>
          <li class="nav-link"><a href="#services">Servizi</a></li>
          <li class="nav-link"><a href="#products">Prodotti</a></li>
          <li class="nav-link"><a href="#blog">Blog</a></li>
          <li class="nav-link"><a href="#contact">Contatti</a></li>
        </ul>
      </div>
    </nav>

    <div class="container main-content">
      <div class="sidebar">
        <div class="menu-item active"><a href="/">Home</a></div>
        <div class="menu-item"><a href="/storici">Storico Controlli</a></div>
        <div class="menu-item">
          <a href="/aggiungiCampo">Aggiungi Campo</a>
        </div>
        <div class="menu-item">
          <a href="/gestioneCampo">Gestione Campo</a>
        </div>
        <div class="menu-item">
          <a href="/visualizzaCampi">Visualizza i tuoi campi</a>
        </div>
      </div>

      <div class="profile-content">
        <h1>I Tuoi Campi</h1>
        <div id="campi" class="campi-container">
          <p>Caricamento in corso...</p>
        </div>
      </div>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const containerCampi = document.getElementById("campi");

        function caricaCampi() {
          fetch("/api/numCampi")
            .then((response) => response.json())
            .then((numCampi) => {
              if (numCampi > 0) {
                containerCampi.innerHTML = "";
                for (let i = 0; i < numCampi; i++) {
                  const card = document.createElement("div");
                  card.className = "campo-card";
                  card.innerHTML = `
                    <h3>Campo ${i + 1}</h3>
                    <form method="POST" action="/">
                      <button type="submit" name="action_ricerca_drone" value="Campo ${
                        i + 1
                      }">Avvia Ricerca Drone</button>
                    </form>
                  `;
                  containerCampi.appendChild(card);
                }
              } else {
                containerCampi.innerHTML =
                  '<div class="p-3 text-center">Nessun campo disponibile.</div>';
              }
            })
            .catch((error) => {
              console.error("Errore nel caricamento dei campi:", error);
              containerCampi.innerHTML =
                '<div class="p-3 text-center">Errore nel caricamento dei campi.</div>';
            });
        }

        caricaCampi();
      });
    </script>
  </body>
</html>
