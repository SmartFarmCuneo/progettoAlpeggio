<!DOCTYPE html>
<html lang="it">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="icon" href="../static/image/logo.png" />
  <title>Agrinnov - Gestione Sensori</title>

  <!-- CSS -->
  <link rel="stylesheet" href="../static/css/style.css" />
  <link rel="stylesheet" href="../static/css/navbar.css" />
  <link rel="stylesheet" href="../static/css/footer.css" />
  <link rel="stylesheet" href="../static/css/media.css" />
  <link rel="stylesheet" href="../static/css/animazioni.css" />
  <link rel="stylesheet" href="../static/css/sensori.css" />

</head>

<body>
  <header>
    <div class="container header-content">
      <a href="/home" class="logo">Agrinnov</a>
      <div class="user-nav">
        <div class="user-info">
          <img src="../static/image/profilo.png" alt="Profilo" class="user-avatar-img" />
          <span>{{user['username']}}</span>
          <form action="/logout" method="POST">
            <button class="logout-btn">Logout</button>
          </form>
        </div>
      </div>
    </div>
  </header>

  <div class="container">
    <div class="main-content">
      <div class="sidebar">
        <div class="menu-item">
          <a href="/home">Home</a>
        </div>
        <div class="menu-item">
          <a href="/profilo">Il Mio Profilo</a>
        </div>
        <div class="menu-item">
          <a href="/pagamenti">Up-grade dell'account</a>
        </div>
        <div class="menu-item active">
          <a href="/gestione_sensori">Gestione sensori</a>
        </div>
      </div>

      <div class="profile-content">
        <div id="success-alert" class="alert alert-success" style="display: none">
          Operazione completata con successo!
        </div>

        <div id="error-alert" class="alert alert-danger" style="display: none">
          Si Ã¨ verificato un errore. Riprova.
        </div>

        <div class="profile-header">
          <h1>Gestione Sensori</h1>
          <div class="btn-right">
            <button type="button" id="add-sensor-btn" class="edit-mode-toggle">
              +
            </button>
          </div>
        </div>

        <div class="profile-section">
          <h2 class="section-title">I Miei Sensori</h2>
          {% set stati = {
          'O': 'Operativo',
          'C': 'Disponibile',
          'S': 'Sospeso'
          } %}

          {% if sensori and sensori|length > 0 %}
          <div class="sensors-grid">
            {% for sensore in sensori %}
            <div class="sensor-card">
              <!--<h3>{{ sensore['nome_sensore'] }}</h3>-->
              <p><strong>ID Sensore:</strong> <span class="sensor-id">{{ sensore['id_sens'] }}</span></p>
              <p><strong>Node ID:</strong> <span class="sensor-id">{{ sensore['Node_id'] }}</span></p>
              <!--<p><strong>Data Registrazione:</strong> {{ sensore['data_registrazione'].strftime('%d/%m/%Y') if sensore['data_registrazione'] else 'N/A' }}</p>-->
              <p><strong>Posizione Sensore:</strong> <span class="sensor-id">{{ sensore['posizione'] }}</span></p>
              <p><strong>Stato Sensore:</strong><span class="sensor-id">{{ sensore['stato_sens'] }} ({{
                  stati.get(sensore['stato_sens'], 'Stato sconosciuto') }})</span></p>
              <div class="sensor-actions">

                <!-- Pulsante ELIMINA -->
                <form method="POST" action="/gestione_sensori" style="display: inline;"
                  onsubmit="return confirm('Sei sicuro di voler eliminare questo sensore?');">
                  <input type="hidden" name="action" value="elimina">
                  <input type="hidden" name="id_sensore" value="{{ sensore['Node_id'] }}">
                  <button type="submit" class="cancel-btn">Elimina</button>
                </form>

                <!-- Pulsante SOSPENDI -->
                {% if sensore['stato_sens'] == 'O' or sensore['stato_sens'] == 'C' %}
                <form method="POST" action="/gestione_sensori" style="display: inline;"
                  onsubmit="return confirm('Vuoi sospendere questo sensore?');">
                  <input type="hidden" name="action" value="sospendi">
                  <input type="hidden" name="id_sensore" value="{{ sensore['Node_id'] }}">
                  <button type="submit" class="warning-btn">Sospendi</button>
                </form>
                {% endif %}

                <!-- Pulsante RIATTIVA -->
                {% if sensore['stato_sens'] == 'S' %}
                <form method="POST" action="/gestione_sensori" style="display: inline;"
                  onsubmit="return confirm('Vuoi riattivare questo sensore?');">
                  <input type="hidden" name="action" value="riattiva">
                  <input type="hidden" name="id_sensore" value="{{ sensore['Node_id'] }}">
                  <button type="submit" class="success-btn">Riattiva</button>
                </form>
                {% endif %}
              </div>
            </div>
            {% endfor %}
          </div>
          {% else %}
          <div class="no-sensors">
            <p>Non hai ancora registrato nessun sensore.</p>
            <p>Clicca su "Aggiungi Sensore" per iniziare.</p>
          </div>
          {% endif %}
        </div>
      </div>
    </div>
  </div>

  <!-- Modal per aggiungere sensore -->
  <div id="addSensorModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Aggiungi Nuovo Sensore</h2>
        <span class="close">&times;</span>
      </div>
      <form id="add-sensor-form" method="POST" action="/gestione_sensori">
        <div class="modal-body">
          <input type="hidden" name="action" value="aggiungi">

          <div class="form-group">
            <label class="form-label" for="id_sensore">ID Sensore *</label>
            <input type="text" id="id_sensore" name="id_sensore" class="form-control" placeholder="Es: ID010000"
              required />
            <small style="color: var(--text-body); font-size: 0.85em;">Inserisci l'ID univoco del sensore</small>
          </div>
          <br>
          <div class="form-group">
            <label class="form-label" for="nome_sensore">Posizione Sensore *</label>
            <input type="text" id="nome_sensore" name="posizione_sensore" class="form-control"
              placeholder="Es: 44.467866, 7.440114" required />
            <small style="color: var(--text-body); font-size: 0.85em;">Posizione per il sensore</small>
          </div>
        </div>
        <div class="modal-footer">
          <button type="submit" class="edit-mode-toggle save">Aggiungi</button>
        </div>
      </form>
    </div>
  </div>

  <!-- FOOTER -->
  <footer id="contact">
    <div class="container">
      <p>&copy; 2024 Agrinnov. Innovazione per l'agricoltura del futuro.</p>
      <ul class="footer-links">
        <li><a href="/privacy">Privacy Policy</a></li>
        <li><a href="/terms">Termini di Servizio</a></li>
        <li><a href="/supporto">Supporto</a></li>
        <li><a href="/contatti">Contatti</a></li>
      </ul>
    </div>
  </footer>
  {% if not cookie_consent %} {% include "cookie_banner.html" %} {% endif %}

  <!-- Script-->
  <script src="../static/js/gestione_sensori.js" defer></script>
</body>

</html>