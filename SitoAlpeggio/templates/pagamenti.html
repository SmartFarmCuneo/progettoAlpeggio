<!DOCTYPE html>
<html lang="it">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Agritech - Profilo</title>
    <link rel="stylesheet" href="../static/css/style.css" />
  </head>

  <body>
    <header>
      <div class="container header-content">
        <a href="/home" class="logo">ðŸŒ± Agritech</a>
        <div class="user-nav">
          <div class="user-info">
            <img
              src="../static/image/profilo.png"
              alt="Profilo"
              class="user-avatar-img"
            />
            <span>{{user['username']}}</span>
            <form action="/logout" method="POST">
              <button class="logout-btn">Logout</button>
            </form>
          </div>
        </div>
      </div>
    </header>

    <div class="container">
      <div class="main-content">
        <div class="sidebar">
          <div class="menu-item active">Il Mio Profilo</div>
          <div class="menu-item">Up-grade dell'account</div>
          <div class="menu-item">Supporto</div>
        </div>

        <div class="profile-content">
          <div
            id="success-alert"
            class="alert alert-success"
            style="display: none"
          >
            Profilo aggiornato con successo!
          </div>

          <form id="profile-form" action="/profilo" method="POST">
            <div class="profile-header">
              <h1>Il Mio Profilo</h1>
              <div class="btn-right">
                <button
                  type="button"
                  id="cancel-btn"
                  class="edit-mode-toggle cancel"
                  style="display: none"
                >
                  Annulla
                </button>
                <button
                  type="button"
                  id="edit-btn"
                  class="edit-mode-toggle"
                  name="action-salvataggio"
                  value="Modifica"
                >
                  Modifica
                </button>
              </div>
            </div>

            <div class="profile-section">
              <h2 class="section-title">Informazioni Personali</h2>
              <div class="form-row">
                <div class="form-group">
                  <label class="form-label" for="nome">Nome</label>
                  <input
                    type="text"
                    id="nome"
                    name="nome"
                    class="form-control"
                    value="{{user['nome']}}"
                    name="nome"
                    readonly
                  />
                </div>
                <div class="form-group">
                  <label class="form-label" for="cognome">Cognome</label>
                  <input
                    type="text"
                    id="cognome"
                    name="cognome"
                    class="form-control"
                    value="{{user['cognome']}}"
                    readonly
                  />
                </div>
              </div>

              <div class="form-row">
                <div class="form-group">
                  <label class="form-label" for="email">Email</label>
                  <input
                    type="email"
                    id="email"
                    name="email"
                    class="form-control"
                    value="{{user['email']}}"
                    readonly
                  />
                </div>
                <div class="form-group">
                  <label class="form-label" for="telefono">Telefono</label>
                  <input
                    type="tel"
                    id="telefono"
                    name="telefono"
                    class="form-control"
                    value="{{user['telefono']}}"
                    readonly
                  />
                </div>
              </div>

              <div class="form-row">
                <div class="form-group">
                  <label class="form-label" for="codice-fiscale"
                    >Codice Fiscale</label
                  >
                  <input
                    type="text"
                    id="codice-fiscale"
                    name="cod_fiscale"
                    class="form-control"
                    value="{{user['cod_fiscale']}}"
                    readonly
                  />
                </div>
                <div class="form-group">
                  <label class="form-label" for="data-nascita"
                    >Data di Nascita</label
                  >
                  <input
                    type="date"
                    id="data-nascita"
                    name="DataDiNascita"
                    class="form-control"
                    value="{{user['DataDiNascita']}}"
                    readonly
                  />
                </div>
              </div>
            </div>

            <div class="profile-section">
              <h2 class="section-title">Impostazioni Account</h2>
              <div class="form-row">
                <div class="form-group">
                  <label class="form-label" for="username">Nome Utente</label>
                  <input
                    type="text"
                    id="username"
                    name="username"
                    class="form-control"
                    value="{{user['username']}}"
                    readonly
                  />
                </div>
              </div>

              <div class="form-row">
                <div class="form-group">
                  <label class="form-label" for="notifiche"
                    >Notifiche Email</label
                  >
                  <select
                    id="notifiche"
                    name="notifiche"
                    class="form-control"
                    disabled
                  >
                    <option value="all" selected>Tutte le notifiche</option>
                    <option value="important">Solo notifiche importanti</option>
                    <option value="none">Nessuna notifica</option>
                  </select>
                </div>
                <div class="form-group">
                  <label class="form-label" for="password">Password</label>
                  <input
                    type="password"
                    id="password"
                    name="password"
                    class="form-control"
                    value="********"
                    readonly
                  />
                </div>
              </div>
            </div>

            <!-- Hidden submit button -->
            <input
              type="hidden"
              name="action-salvataggio"
              id="action-salvataggio"
              value=""
            />
          </form>
        </div>
      </div>
    </div>

    <script>
      // FunzionalitÃ  JavaScript per la modifica del profilo
      document.addEventListener("DOMContentLoaded", function () {
        const editBtn = document.getElementById("edit-btn");
        const cancelBtn = document.getElementById("cancel-btn");
        const successAlert = document.getElementById("success-alert");
        const profileForm = document.getElementById("profile-form");
        const actionInput = document.getElementById("action-salvataggio");
        const formInputs = document.querySelectorAll(
          '#profile-form input:not([type="hidden"]), #profile-form select'
        );
        const originalValues = {};

        // Salva i valori originali
        formInputs.forEach((input) => {
          originalValues[input.id] = input.value;
        });

        // Attiva modalitÃ  modifica
        editBtn.addEventListener("click", function () {
          if (editBtn.value === "Modifica") {
            // Passa alla modalitÃ  modifica
            formInputs.forEach((input) => {
              if (input.id !== "password") {
                // Mantieni password in sola lettura
                input.readOnly = false;
                if (input.tagName === "SELECT") {
                  input.disabled = false;
                }
              }
            });

            editBtn.textContent = "Salva";
            editBtn.value = "Salva";
            editBtn.classList.add("save");
            cancelBtn.style.display = "inline-block";
            successAlert.style.display = "none";
          } else {
            // Salva le modifiche
            actionInput.value = "Salva"; // Imposta il valore per l'azione di salvataggio
            profileForm.submit(); // Invia il form
          }
        });

        // Annulla modifiche
        cancelBtn.addEventListener("click", function () {
          formInputs.forEach((input) => {
            input.value = originalValues[input.id]; // Ripristina valori originali
            input.readOnly = true;
            if (input.tagName === "SELECT") {
              input.disabled = true;
            }
          });

          editBtn.textContent = "Modifica";
          editBtn.classList.remove("save");
          cancelBtn.style.display = "none";
          successAlert.style.display = "none";
        });

        // Se c'Ã¨ un parametro nell'URL che indica un salvataggio avvenuto, mostra il messaggio di successo
        const urlParams = new URLSearchParams(window.location.search);
        if (urlParams.has("saved") && urlParams.get("saved") === "true") {
          successAlert.style.display = "block";
          setTimeout(() => {
            successAlert.style.display = "none";
          }, 3000);
        }
      });
    </script>
    <!-- FOOTER -->
    <footer id="contact">
      <div class="container">
        <p>&copy; 2024 Agritech. Innovazione per l'agricoltura del futuro.</p>
        <ul class="footer-links">
          <li><a href="#">Privacy Policy</a></li>
          <li><a href="#">Termini di Servizio</a></li>
          <li><a href="#">Supporto</a></li>
          <li><a href="#">Contatti</a></li>
        </ul>
      </div>
    </footer>
  </body>
</html>
